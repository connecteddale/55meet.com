# Research Summary: v2.1 Facilitator Experience & Presentation

**Project:** The 55 Workshop Facilitation App
**Milestone:** v2.1 — Facilitator Experience & Presentation Enhancements
**Researched:** 2026-01-19
**Confidence:** HIGH

## Overview

This research covers four areas for The 55 v2.1 milestone: stack validation (v2.1-STACK.md), feature priorities (FEATURES.md), architecture patterns (v2.1-ARCHITECTURE.md), and implementation pitfalls (PITFALLS.md). The milestone focuses on improving the live facilitation experience through better image gallery pagination, combined QR/status projection screens, session flow controls (reopen, clear submission), and three-level AI synthesis presentation.

All research confirms v2.1 features can be built with the existing stack (no new dependencies). The critical insight is that **all features must be bulletproof for live 55-minute facilitation sessions** — any bug or confusion during a workshop damages facilitator credibility. The highest-risk areas are: mobile Safari sticky navigation quirks, session state race conditions during reopen/close operations, and synthesis failures during presentation moments.

---

## Key Stack Decisions

### What to Use

The existing stack supports all v2.1 features without additions:

| Technology | v2.1 Use |
|------------|----------|
| FastAPI + Jinja2 | Server-rendered views with tab-based presentation levels |
| SQLAlchemy + SQLite | Session state transitions, response clear operations |
| qrcode[pil] 8.2 | QR code generation as base64 data URI — already installed |
| Anthropic SDK 0.76.0 | Structured outputs for synthesis via JSON schema mode |
| Vanilla JS (ES6+) | Pagination, keyboard navigation, polling enhancements |
| CSS sticky | Sticky image navigation header with vendor prefixes |

### What NOT to Use

- **NO React/Vue/frameworks** — Project constraint: no build step
- **NO WebSockets/SSE** — Current 2.5s polling works for 25 users
- **NO JavaScript libraries** — Fisher-Yates shuffle is 4 lines, native ES6 sufficient
- **NO CSS frameworks** — Existing design system with CSS variables
- **NO database migrations** — Schema unchanged for v2.1

---

## Feature Priorities

### P0 — Must Ship (Core Facilitation)

| Feature | Rationale |
|---------|-----------|
| Combined QR + status screen | Single-screen projection during capture phase |
| Close early / reopen controls | Handle absent participants, latecomers |
| Three-level synthesis presentation | Themes → Grouped Insights → Raw Statements |

### P1 — High Value (UX Refinement)

| Feature | Rationale |
|---------|-----------|
| Sticky image navigation | Always-visible pagination on mobile |
| Fixed instruction at top | Context always visible during selection |
| Level-specific export | JSON export per synthesis level |

### P2 — If Time Permits (Polish)

| Feature | Rationale |
|---------|-----------|
| Clear individual submission | Handle resubmission edge case |
| 200+ images with randomization | Expanded library, session-seeded order |
| Projector-optimized typography | Large text, high contrast for distance viewing |

### Anti-Features (Do NOT Build)

- Pinch-to-zoom on images (defeats selection workflow)
- Image search/filter (defeats metaphor discovery)
- Automated phase progression (facilitator sets pace)
- Real-time synthesis streaming (complete > partial)
- Charts/visualizations (text themes sufficient)

---

## Architecture Approach

### Build Order Based on Dependencies

The architecture research identifies clear dependencies that dictate build order:

1. **Image Library Service** must exist before participant browser changes
2. **Session state endpoints** (reopen, clear) must exist before UI controls
3. **Presentation endpoint enhancement** must exist before tab navigation

### New Components

```
app/services/images.py     # NEW: Image discovery and caching
```

### Modified Components

```
app/config.py              # Add: IMAGE_LIBRARY_PATH, IMAGES_PER_PAGE
app/routers/images.py      # Add: pagination params, seed for randomization
app/routers/sessions.py    # Add: POST /reopen, DELETE /responses/{member_id}
templates/participant/respond.html  # Update: dynamic pagination
templates/admin/sessions/present.html  # Update: three-level tabs
```

### Key Architecture Patterns

| Pattern | Implementation |
|---------|----------------|
| Server-side shuffle | Fisher-Yates with session_id as seed for consistent order |
| File auto-discovery | Runtime directory scan with caching (5 min TTL) |
| State machine extension | closed/revealed → capturing (reopen transition) |
| Tab-based presentation | Single page with level query param + keyboard nav |
| QR as data URI | Base64 PNG embedded in HTML, no separate request |

---

## Critical Pitfalls

### Top 5 Risks to Watch

| Pitfall | Impact | Prevention |
|---------|--------|------------|
| **SC-1: Reopen during synthesis** | CRITICAL — State corruption | Clear synthesis on reopen, track generation_id |
| **SC-5: Accidental clear all** | CRITICAL — Data destruction | Two-step confirmation, hide in "Danger Zone" |
| **AI-1: Synthesis fails at presentation** | CRITICAL — Presentation ruined | Explicit status tracking, retry button, raw fallback |
| **IG-1: Sticky header on iOS Safari** | HIGH — Mobile unusable | Use -webkit-sticky prefix, 100dvh, no overflow:hidden |
| **RD-1: QR not scannable on projection** | HIGH — Session start blocked | 400px QR, high contrast, always show fallback URL |

### Phase-Specific Pitfall Mapping

| Phase | Critical Pitfalls to Address |
|-------|------------------------------|
| Image Gallery | IG-1 (sticky iOS), IG-4 (swipe conflicts), IG-2 (pagination state) |
| Session Controls | SC-1 (reopen race), SC-2 (clear during edit), SC-3 (stale close) |
| Projection Screen | RD-1 (QR scan), RD-3 (aspect ratios), RD-5 (screen sleep) |
| AI Presentation | AI-1 (silent failure), AI-2 (partial data), AI-3 (timeout) |

---

## Roadmap Recommendations

Based on combined research findings, the recommended phase structure:

### Phase 1: Image Library Foundation

**Rationale:** Required foundation before participant-facing changes. Low risk, isolated change.

**Delivers:**
- Image discovery service with caching
- Pagination API with seed parameter
- Config settings for image path, per-page count

**Features:** Auto-discovery, randomization (session-seeded)

**Avoids:** IG-6 (slow load) via AJAX pagination

**Estimated scope:** Small — service + config + API changes

---

### Phase 2: Participant Image Browser

**Rationale:** Builds on Phase 1 API. High-value mobile UX improvement.

**Delivers:**
- Sticky navigation with pagination controls
- Fixed instruction header
- AJAX page loading
- Selection state persistence

**Features:** Sticky nav, 2-column grid, pagination state, "jump to selection"

**Avoids:** IG-1 (iOS sticky), IG-2 (state lost), IG-4 (swipe conflicts)

**Estimated scope:** Medium — template + CSS + JavaScript

---

### Phase 3: Session Flow Controls

**Rationale:** Core facilitator feature. State machine changes must be carefully implemented.

**Delivers:**
- POST /sessions/{id}/reopen endpoint
- DELETE /sessions/{id}/responses/{member_id} endpoint
- UI controls with confirmation dialogs
- Participant notification on clear/reopen

**Features:** Close early, reopen capture, clear individual submission

**Avoids:** SC-1 (reopen race), SC-2 (clear during edit), SC-3 (stale close)

**Estimated scope:** Medium — endpoints + UI + polling enhancement

---

### Phase 4: Combined QR + Status Screen

**Rationale:** High-value facilitator feature. Projection-specific concerns.

**Delivers:**
- Single screen with QR code + participant status
- Projector-optimized layout (responsive to aspect ratios)
- Large, scannable QR with fallback URL
- Status updates without flicker

**Features:** Combined view, visual status indicators, wake lock

**Avoids:** RD-1 (QR scan), RD-2 (flicker), RD-3 (aspect ratio), RD-5 (sleep)

**Estimated scope:** Medium — new template + CSS + JavaScript

---

### Phase 5: Three-Level Synthesis Presentation

**Rationale:** Final piece. Builds on existing synthesis infrastructure.

**Delivers:**
- Tab navigation for Themes / Grouped / Raw levels
- Keyboard navigation (1/2/3 keys, arrows)
- Level-specific JSON export endpoints
- Explicit synthesis status with retry

**Features:** Progressive disclosure, projector-optimized typography, level export

**Avoids:** AI-1 (silent failure), AI-4 (navigation hard), AI-5 (accidental attribution)

**Estimated scope:** Medium — endpoint extension + template + JavaScript

---

### Phase Ordering Rationale

1. **Image Library first** — Foundation that other features don't depend on, safe to ship early
2. **Image Browser second** — Uses Phase 1 API, improves participant experience independently
3. **Session Controls third** — Core facilitator need, no dependency on other phases
4. **QR + Status fourth** — Projection feature, benefits from stable session controls
5. **Synthesis Presentation last** — Builds on existing synthesis, highest integration complexity

### Research Flags

**Phases with well-documented patterns (skip further research):**
- Phase 1 (Image Library): Standard file discovery + caching
- Phase 2 (Image Browser): CSS sticky + pagination — documented patterns
- Phase 4 (QR + Status): QR generation already works, layout is CSS

**Phases that may need validation during implementation:**
- Phase 3 (Session Controls): Race condition testing needed with actual polling intervals
- Phase 5 (Synthesis Presentation): Claude structured outputs behavior may need runtime validation

---

## Confidence Assessment

| Area | Confidence | Notes |
|------|------------|-------|
| Stack | HIGH | Existing stack verified, no additions needed |
| Features | HIGH | Mature UX patterns, clear market evidence |
| Architecture | HIGH | Based on direct codebase analysis |
| Pitfalls | HIGH | Verified browser issues + live facilitation context |

**Overall confidence:** HIGH

### Gaps to Address

| Gap | Resolution |
|-----|------------|
| iOS Safari sticky behavior | Test on actual device, not Chrome DevTools simulation |
| Synthesis structured outputs | Verify Claude JSON schema mode works with current SDK |
| 200+ image performance | Profile after images added, optimize if needed |
| Projector aspect ratio coverage | Test on 16:9, 4:3, and vertical displays |

---

## Sources

### Primary (HIGH confidence)

- Existing codebase analysis: `/var/www/the55/app/`
- [Apple HIG Touch Targets](https://developer.apple.com/design/human-interface-guidelines/)
- [CSS Position Sticky - How It Really Works](https://elad.medium.com/css-position-sticky-how-it-really-works-54cd01dc2d46)
- [Claude Structured Outputs Docs](https://platform.claude.com/docs/en/build-with-claude/structured-outputs)
- [qrcode Python Library](https://pypi.org/project/qrcode/)

### Secondary (MEDIUM confidence)

- [Nielsen Norman Group - Mobile Navigation](https://www.nngroup.com/articles/image-vs-list-mobile-navigation/)
- [Smashing Magazine - Thumb Zone](https://www.smashingmagazine.com/2016/09/the-thumb-zone-designing-for-mobile-users/)
- [Insight7 - Data Executive Summary](https://insight7.io/data-executive-summary-presenting-complex-information-clearly/)
- [QR Code Best Practices for Live Events](https://www.linkedin.com/pulse/5-ways-display-qr-code-live-events-patrick-rife)

---

*Research completed: 2026-01-19*
*Ready for roadmap: yes*
