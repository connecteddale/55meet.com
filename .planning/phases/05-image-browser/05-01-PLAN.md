---
phase: 14-image-browser
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - the55/app/routers/participant.py
  - the55/app/templates/participant/respond.html
  - the55/app/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "Participant can browse 55 images in pages of 6"
    - "Participant can select an image representing current state"
    - "Selected image is visually highlighted"
    - "Navigation shows current position (e.g., 1-6 of 55)"
  artifacts:
    - path: "the55/app/templates/participant/respond.html"
      provides: "Image browser grid and selection UI"
      min_lines: 80
    - path: "the55/app/routers/participant.py"
      provides: "Response page endpoint"
      contains: "respond"
  key_links:
    - from: "strategy.html I'm Ready button"
      to: "/respond route"
      via: "form action POST"
---

<objective>
Implement image browser UI with paginated 55-image grid.

Purpose: Enable participants to browse all 55 images and select one that represents their current state.
Output: Image browser template with pagination, selection handling, and mobile-first CSS.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/research/PITFALLS.md

# Prior phase context
@.planning/phases/13-participant-entry/13-02-SUMMARY.md

# Source files
@the55/app/routers/participant.py
@the55/app/db/models.py
@the55/app/static/css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add respond page endpoint</name>
  <files>the55/app/routers/participant.py</files>
  <action>
Add GET and POST endpoints for the respond page:

1. GET `/{code}/session/{session_id}/member/{member_id}/respond`:
   - Validate team/session/member exists
   - Check session is in CAPTURING state
   - Check if member already has a response (for edit mode)
   - Return respond.html template with:
     - team, session, member context
     - existing_response (if any) for pre-populating form
     - image_range: list of tuples [(1,6), (7,12)...] for pagination

2. POST `/{code}/session/{session_id}/member/{member_id}/respond`:
   - Parse form: image_number (int 1-55), bullets (text, JSON array)
   - Validate session is still CAPTURING (else redirect with error)
   - If response exists for this member/session: UPDATE
   - If no response: INSERT
   - Redirect to waiting page on success

Use SQLAlchemy session properly - commit after insert/update.
Validate image_number is 1-55, bullets is valid JSON array of 1-5 non-empty strings.
  </action>
  <verify>
curl -X GET http://localhost:8000/join/TESTCODE/session/1/member/1/respond returns 200
  </verify>
  <done>Respond page endpoint serves template, accepts form submission</done>
</task>

<task type="auto">
  <name>Task 2: Create image browser template</name>
  <files>the55/app/templates/participant/respond.html</files>
  <action>
Create respond.html with image browser UI:

1. Header: Team name, member name, "Select an image"

2. Image grid container:
   - CSS grid/flexbox with 2 columns on mobile (375px), 3 on tablet
   - Show 6 images at a time (page 1: images 1-6, page 2: 7-12, etc.)
   - Each image card:
     - Placeholder image from /static/images/55/{n}.png
     - Image number label
     - Radio input (hidden) for selection
     - Selected state with visual border/highlight
   - Use cursor:pointer on cards (CP-3: iOS Safari touch fix)

3. Pagination:
   - Previous/Next buttons
   - Position indicator: "1-6 of 55"
   - JavaScript to show/hide pages without server round-trip
   - Preserve selection across page navigation

4. Selection state:
   - When image clicked: add 'selected' class, update hidden radio
   - Visual feedback: 4px border, subtle scale

5. Image loading strategy (PT-1):
   - First 6 images: loading="eager" fetchpriority="high"
   - Remaining images: loading="lazy"

6. Pre-populate if editing:
   - If existing_response passed from server, set selected image
   - Jump to correct page containing that image

Continue button at bottom (disabled until selection made).
  </action>
  <verify>Template renders, shows 6 images with pagination controls</verify>
  <done>Image browser displays all 55 images with pagination and selection</done>
</task>

<task type="auto">
  <name>Task 3: Add image browser CSS</name>
  <files>the55/app/static/css/main.css</files>
  <action>
Add CSS for image browser:

```css
/* Image Browser */
.image-browser {
  padding: 1rem;
}

.image-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

@media (min-width: 768px) {
  .image-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

.image-card {
  position: relative;
  cursor: pointer;  /* CP-3: iOS Safari touch fix */
  border: 2px solid transparent;
  border-radius: 8px;
  overflow: hidden;
  transition: border-color 0.15s, transform 0.15s;
}

.image-card.selected {
  border-color: var(--primary);
  transform: scale(1.02);
}

.image-card img {
  width: 100%;
  aspect-ratio: 1;
  object-fit: cover;
}

.image-card .image-number {
  position: absolute;
  bottom: 0.25rem;
  right: 0.25rem;
  background: rgba(0,0,0,0.6);
  color: white;
  font-size: 0.75rem;
  padding: 0.125rem 0.375rem;
  border-radius: 4px;
}

/* Pagination */
.pagination-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
  padding: 0.5rem 0;
}

.pagination-controls button {
  padding: 0.5rem 1rem;
  border: 1px solid var(--gray-300);
  border-radius: 4px;
  background: white;
  cursor: pointer;
}

.pagination-controls button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-info {
  font-size: 0.875rem;
  color: var(--gray-600);
}
```

Use flex-basis: 150px fallback for older browsers (BC-2).
Ensure grid gap has margin fallback with @supports.
  </action>
  <verify>CSS loads, grid displays correctly at 375px and 768px breakpoints</verify>
  <done>Image browser styled with mobile-first responsive grid</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] GET /join/{code}/session/{id}/member/{id}/respond returns 200
- [ ] Template shows 6 images at a time
- [ ] Pagination navigates through all 55 images
- [ ] Image selection adds visual highlight
- [ ] Selection persists across pagination
- [ ] First 6 images load eagerly, rest lazy
- [ ] Layout works at 375px viewport
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Image browser navigable on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/14-image-browser/14-01-SUMMARY.md`
</output>
