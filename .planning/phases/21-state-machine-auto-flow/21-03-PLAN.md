---
phase: 34-state-machine-auto-flow
plan: 03
type: execute
wave: 3
depends_on: ["34-02"]
files_modified:
  - sites/55meet.com/templates/admin/sessions/view.html
  - sites/55meet.com/templates/admin/sessions/create.html
autonomous: true

must_haves:
  truths:
    - "Admin session view has no 'Start Capturing' button"
    - "Admin session view has no 'Generate Synthesis' button"
    - "Admin session view shows auto-progress messaging when session is CLOSED"
    - "QR code panel shows for CAPTURING state only (not draft)"
  artifacts:
    - path: "sites/55meet.com/templates/admin/sessions/view.html"
      provides: "Simplified admin controls without DRAFT/manual synthesis buttons"
    - path: "sites/55meet.com/templates/admin/sessions/create.html"
      provides: "Create form without draft-related messaging"
  key_links:
    - from: "sites/55meet.com/templates/admin/sessions/view.html"
      to: "session state logic"
      via: "Template conditionals check for capturing/closed/revealed only"
      pattern: "session.state.value"
---

<objective>
Update admin UI to reflect the automated session lifecycle.

Purpose: Remove buttons for manual steps that are now automated (Start Capturing, Generate Synthesis). Show appropriate auto-progress messaging instead.
Output: Clean admin interface where facilitator only sees "Close Capture" as their action, with automated progress for synthesis.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/34-state-machine-auto-flow/34-02-SUMMARY.md

Key source files:
@sites/55meet.com/templates/admin/sessions/view.html — Full template with state-based controls
@sites/55meet.com/templates/admin/sessions/create.html — Session creation form
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update admin session view template</name>
  <files>
    sites/55meet.com/templates/admin/sessions/view.html
    sites/55meet.com/templates/admin/sessions/create.html
  </files>
  <action>
1. In `templates/admin/sessions/view.html`:

   a. QR panel conditional (line 31): Change `{% if session.state.value in ['draft', 'capturing'] %}` to `{% if session.state.value == 'capturing' %}` — no more draft state exists.

   b. Controls panel (lines 54-94): Remove the entire DRAFT block:
      ```
      {% if session.state.value == 'draft' %}
      <form method="post" action="/admin/sessions/{{ session.id }}/start">
          <button type="submit" class="btn btn-primary btn-block">Start Capturing</button>
      </form>
      <p class="hint">Participants can join once capturing starts.</p>
      ```
      The `{% elif session.state.value == 'capturing' %}` becomes `{% if session.state.value == 'capturing' %}`.

   c. In the CLOSED/REVEALED controls section: Remove the `synthesis_pending` block that shows "Generate Synthesis" button (lines 69-73):
      ```
      {% if synthesis_pending %}
      <form method="post" action="/admin/sessions/{{ session.id }}/synthesize" id="synthesize-form">
          <button type="submit" class="btn btn-primary btn-block" id="synthesize-btn">Generate Synthesis</button>
      </form>
      <p class="hint" id="synthesize-hint">Analyze responses and generate themes.</p>
      ```
      Replace with an auto-progress indicator:
      ```html
      {% if synthesis_pending or synthesis_generating %}
      <div class="synthesis-loading">
          <div class="spinner"></div>
          <p>Synthesizing responses...</p>
          <p class="hint">Results will appear automatically (30-60 seconds)</p>
      </div>
      ```
      This combines the old synthesis_pending and synthesis_generating states since synthesis now auto-triggers.

   d. Keep the "Regenerate Synthesis" button (line 85-88) — this is the manual fallback for errors.

   e. Keep the "Reopen Engagement" button — this is still needed.

   f. Keep export buttons (PDF, JSON, Markdown) — these are useful.

   g. In the scripts block (lines 215-291):
      - Remove the `{% if session.state.value == 'closed' and synthesis_pending %}` script block (lines 220-240) — no manual synthesize button to handle.
      - Keep the `{% if synthesis_generating %}` polling script — still needed for auto-refresh when synthesis completes.
      - UPDATE the synthesis_generating polling condition: change `{% if synthesis_generating %}` to `{% if session.state.value == 'closed' and (synthesis_pending or synthesis_generating) %}` so polling activates immediately on close.

2. In `templates/admin/sessions/create.html`:
   - Check if there's any messaging about "draft" or "start capturing" — update text if needed. The form creates sessions that now immediately start capturing, so any hint text about "draft" should say "Session will start accepting responses immediately."
  </action>
  <verify>
    grep -c "Start Capturing" sites/55meet.com/templates/admin/sessions/view.html — should return 0
    grep -c "Generate Synthesis" sites/55meet.com/templates/admin/sessions/view.html — should return 0
    grep -c "draft" sites/55meet.com/templates/admin/sessions/view.html — should return 0
    grep "Synthesizing" sites/55meet.com/templates/admin/sessions/view.html — should show auto-progress text
    grep "Regenerate" sites/55meet.com/templates/admin/sessions/view.html — should still show regenerate button (fallback)
  </verify>
  <done>Admin view has no DRAFT controls, no manual Synthesize button. Shows auto-progress when synthesis is running. Regenerate and Reopen remain as fallbacks. Create form updated if needed.</done>
</task>

</tasks>

<verification>
- No "Start Capturing" button in admin UI
- No "Generate Synthesis" button in admin UI
- Auto-progress spinner shows when session is CLOSED and synthesis is running
- Regenerate Synthesis button still available after synthesis completes (fallback)
- Reopen Engagement button still available
- Export buttons still available after synthesis
- Polling script activates for CLOSED state to auto-refresh on completion
- No reference to 'draft' state in any template
</verification>

<success_criteria>
- Facilitator flow reduced to: Create session -> Close Capture -> (auto) -> See Results
- Only manual action needed is "Close Capture"
- UI provides clear feedback during automated synthesis
- Error recovery still possible via Regenerate button
</success_criteria>

<output>
After completion, create `.planning/phases/34-state-machine-auto-flow/34-03-SUMMARY.md`
</output>
