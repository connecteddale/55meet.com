---
phase: 27-unified-meeting-screen
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - the55/app/routers/sessions.py
  - the55/app/templates/admin/sessions/meeting.html
  - the55/app/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "Single /meeting URL serves both capture and presentation modes"
    - "Capture mode shows QR code and participant status"
    - "State changes trigger template re-render (not page jumps)"
    - "Typography is readable from back of room (24px+ body, 48px+ headings)"
  artifacts:
    - path: "the55/app/routers/sessions.py"
      provides: "GET /admin/sessions/{id}/meeting endpoint"
      contains: "def meeting_session"
    - path: "the55/app/templates/admin/sessions/meeting.html"
      provides: "Unified meeting template with state-driven rendering"
      min_lines: 100
    - path: "the55/app/static/css/main.css"
      provides: "Meeting mode styles with projector optimization"
      contains: ".meeting-mode"
  key_links:
    - from: "the55/app/routers/sessions.py"
      to: "the55/app/templates/admin/sessions/meeting.html"
      via: "templates.TemplateResponse"
      pattern: "meeting\\.html"
---

<objective>
Create unified meeting screen endpoint and template that combines capture and presentation modes into a single projectable view.

Purpose: Eliminate tab-switching during facilitated sessions - facilitator projects ONE URL for entire meeting flow (MEET-01).
Output: Working `/admin/sessions/{id}/meeting` endpoint with state-driven template rendering and projector-optimized typography.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-unified-meeting-screen/27-RESEARCH.md

# Existing implementations to reference
@the55/app/routers/sessions.py (capture_session and present_session endpoints)
@the55/app/templates/admin/sessions/capture.html
@the55/app/templates/admin/sessions/present.html
@the55/app/static/css/main.css (capture-mode and presentation-mode styles)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add unified meeting endpoint</name>
  <files>the55/app/routers/sessions.py</files>
  <action>
Add new GET endpoint at `/admin/sessions/{session_id}/meeting` that:

1. Loads session with team, members, responses (same pattern as view_session)
2. Loads synthesis data if available (same pattern as present_session)
3. Loads raw responses with image URLs for Level 3 (same pattern as present_session)
4. Returns templates.TemplateResponse("admin/sessions/meeting.html", context)

Context dict should include:
- request, session, team
- member_status, total_members, submitted_count
- synthesis_themes, synthesis_statements, synthesis_gap_type, synthesis_gap_reasoning
- raw_responses (for Level 3 display)
- synthesis_failed (boolean for error UI)

This endpoint works for ALL states (draft, capturing, closed, revealed) - the template handles rendering appropriately.

Place this endpoint after the existing capture_session and present_session endpoints (around line 520).

DO NOT modify existing capture and present endpoints - keep them for backwards compatibility.
  </action>
  <verify>
grep -n "def meeting_session" the55/app/routers/sessions.py
curl -s -o /dev/null -w "%{http_code}" http://localhost:8055/admin/sessions/1/meeting (should return 200 or 302)
  </verify>
  <done>New /meeting endpoint returns appropriate template response for any session state</done>
</task>

<task type="auto">
  <name>Task 2: Create unified meeting template</name>
  <files>the55/app/templates/admin/sessions/meeting.html</files>
  <action>
Create new template extending base.html with state-driven content:

```jinja2
{% extends "base.html" %}

{% block title %}Meeting - {{ team.team_name }} | The 55{% endblock %}

{% block head %}
<style>
    body { background: #1a1a2e; color: #eaeaea; }
    header { display: none; }
    main { padding: 0; }
</style>
{% endblock %}

{% block body_class %} class="meeting-mode meeting-{{ session.state.value }}"{% endblock %}

{% block header %}{% endblock %}

{% block content %}
<div class="meeting-screen" data-session-id="{{ session.id }}" data-state="{{ session.state.value }}">

    {# CAPTURE SECTION: Visible in draft/capturing states #}
    {% if session.state.value in ['draft', 'capturing'] %}
    <section class="meeting-capture" id="capture-section">
        <div class="meeting-qr">
            <img src="/admin/qr/team/{{ team.id }}" alt="Scan to join" class="meeting-qr-code">
            <div class="meeting-join-code">{{ team.code }}</div>
            <div class="meeting-join-url">Scan QR or visit /join</div>
        </div>
        <div class="meeting-status">
            <div class="meeting-progress">
                <span id="submitted-count">{{ submitted_count }}</span>/<span id="total-members">{{ total_members }}</span>
            </div>
            <div class="meeting-member-list" id="member-status-list">
                {% for member in member_status %}
                <div class="meeting-member" data-member-id="{{ member.id }}">
                    <span class="member-name">{{ member.name }}</span>
                    <span class="status-indicator {% if member.submitted %}submitted{% else %}waiting{% endif %}">
                        {% if member.submitted %}&#10003;{% else %}...{% endif %}
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    {# CLOSED STATE: Show waiting for synthesis #}
    {% if session.state.value == 'closed' %}
    <section class="meeting-waiting" id="waiting-section">
        <div class="meeting-waiting-content">
            <h1>Analyzing Responses</h1>
            <p>Please wait while we synthesize your team's feedback...</p>
            <div class="meeting-spinner"></div>
        </div>
    </section>
    {% endif %}

    {# SYNTHESIS SECTION: Visible in revealed state #}
    {% if session.state.value == 'revealed' %}
    <section class="meeting-synthesis" id="synthesis-section">
        {% if synthesis_failed %}
        <div class="meeting-error">
            <h2>Synthesis Generation Failed</h2>
            <p>{{ synthesis_themes }}</p>
            <p class="meeting-error-hint">Return to control panel to retry.</p>
        </div>
        {% else %}
        {# Level tabs #}
        <div class="level-tabs">
            <button class="level-tab active" data-level="1">Overview</button>
            <button class="level-tab" data-level="2">Insights</button>
            <button class="level-tab" data-level="3">Raw</button>
        </div>

        {# Level 1: Themes + Gap #}
        <div class="level-content active" data-level="1">
            <div class="meeting-header">
                <h1>{{ team.team_name }}</h1>
                <p class="meeting-meta">{{ team.company_name }} &middot; {{ session.month }}</p>
            </div>
            <div class="meeting-themes">
                <h2>What We Heard</h2>
                <p>{{ synthesis_themes }}</p>
            </div>
            {% if synthesis_gap_type %}
            <div class="meeting-gap">
                <h2>Suggested Gap</h2>
                <span class="meeting-gap-badge gap-{{ synthesis_gap_type|lower }}">{{ synthesis_gap_type }}</span>
                {% if synthesis_gap_reasoning %}
                <p class="meeting-gap-reasoning">{{ synthesis_gap_reasoning }}</p>
                {% endif %}
            </div>
            {% endif %}
        </div>

        {# Level 2: Key Insights #}
        <div class="level-content" data-level="2">
            <div class="meeting-header">
                <h1>Key Insights</h1>
            </div>
            {% if synthesis_statements %}
            <ul class="meeting-insights">
                {% for stmt in synthesis_statements %}
                <li>
                    <span class="insight-statement">{{ stmt.statement }}</span>
                    <span class="insight-names">&mdash; {{ stmt.participants|join(', ') }}</span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="meeting-empty">No insights available.</p>
            {% endif %}
        </div>

        {# Level 3: Raw Responses #}
        <div class="level-content" data-level="3">
            <div class="meeting-header">
                <h1>Individual Responses</h1>
            </div>
            {% if raw_responses %}
            <div class="meeting-raw">
                {% for response in raw_responses %}
                <div class="raw-participant">
                    <h3 class="raw-participant-name">{{ response.participant }}</h3>
                    {% if response.bullets %}
                    <ul class="raw-bullets">
                        {% for bullet in response.bullets %}
                        <li>{{ bullet }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="meeting-empty">No explanation provided</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="meeting-empty">No responses recorded.</p>
            {% endif %}
        </div>
        {% endif %}
    </section>
    {% endif %}

    {# Footer #}
    <footer class="meeting-footer">
        <span class="keyboard-hint">{% if session.state.value == 'revealed' %}Press 1, 2, 3 for detail levels{% endif %}</span>
        <a href="/admin/sessions/{{ session.id }}" class="exit-meeting">Exit to Control Panel</a>
    </footer>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/meeting.js"></script>
{% endblock %}
```

Key design decisions:
- State-driven sections using Jinja conditionals
- Same dark theme as existing capture.html (#1a1a2e background)
- Level tabs for synthesis navigation (same pattern as present.html)
- Data attributes for JS state management
- No admin controls (view-only for projection per MS-3 pitfall)
  </action>
  <verify>
ls -la the55/app/templates/admin/sessions/meeting.html
wc -l the55/app/templates/admin/sessions/meeting.html (should be 100+ lines)
  </verify>
  <done>Unified meeting template renders capture mode for draft/capturing states and synthesis for revealed state</done>
</task>

<task type="auto">
  <name>Task 3: Add meeting mode CSS with projector-optimized typography</name>
  <files>the55/app/static/css/main.css</files>
  <action>
Add new CSS section at end of main.css (after Reduced Motion section, around line 2710):

```css
/* ========================================
   Meeting Mode (Phase 27 - Unified Screen)
   ======================================== */

.meeting-mode {
    background: #1a1a2e;
    color: #eaeaea;
    min-height: 100vh;
}

.meeting-screen {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Capture Section - Two column layout */
.meeting-capture {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-8);
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--space-8);
    flex: 1;
    align-items: center;
}

/* QR Panel */
.meeting-qr {
    text-align: center;
}

.meeting-qr-code {
    width: 400px;
    height: 400px;
    background: white;
    padding: 16px;
    border-radius: 8px;
}

.meeting-join-code {
    font-size: clamp(2.5rem, 4vw, 3.5rem);
    font-weight: 700;
    letter-spacing: 0.2em;
    margin-top: var(--space-6);
    text-transform: uppercase;
}

.meeting-join-url {
    color: rgba(255, 255, 255, 0.5);
    margin-top: var(--space-2);
    font-size: clamp(1rem, 1.5vw, 1.25rem);
}

/* Status Panel */
.meeting-status {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: var(--space-6);
    max-height: 80vh;
    display: flex;
    flex-direction: column;
}

.meeting-progress {
    font-size: clamp(3rem, 5vw, 4.5rem);
    font-weight: 700;
    text-align: center;
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.meeting-member-list {
    overflow-y: auto;
    flex: 1;
}

.meeting-member {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-3) var(--space-4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-size: clamp(1.125rem, 1.5vw, 1.5rem);
}

.meeting-member:last-child {
    border-bottom: none;
}

.meeting-member .member-name {
    color: #eaeaea;
}

.meeting-member .status-indicator.submitted {
    color: #22c55e;
    font-weight: bold;
    font-size: 1.5em;
}

.meeting-member .status-indicator.waiting {
    color: rgba(255, 255, 255, 0.3);
}

/* Waiting Section (Closed state) */
.meeting-waiting {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.meeting-waiting-content h1 {
    font-size: clamp(2.5rem, 5vw, 4rem);
    margin-bottom: var(--space-4);
    color: #eaeaea;
}

.meeting-waiting-content p {
    font-size: clamp(1.25rem, 2vw, 1.75rem);
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: var(--space-8);
}

.meeting-spinner {
    width: 64px;
    height: 64px;
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-top-color: var(--color-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

/* Synthesis Section */
.meeting-synthesis {
    flex: 1;
    max-width: 1000px;
    margin: 0 auto;
    padding: var(--space-8);
}

/* Meeting Header - Projector optimized (MEET-06) */
.meeting-header {
    text-align: center;
    margin-bottom: var(--space-8);
    padding-bottom: var(--space-6);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.meeting-header h1 {
    font-size: clamp(3rem, 5vw, 4rem);
    font-weight: 700;
    letter-spacing: var(--tracking-tight);
    color: #eaeaea;
    margin: 0;
}

.meeting-meta {
    font-size: clamp(1.25rem, 2vw, 1.5rem);
    color: rgba(255, 255, 255, 0.6);
    margin-top: var(--space-2);
}

/* Level Tabs - Meeting variant */
.meeting-synthesis .level-tabs {
    display: flex;
    gap: var(--space-2);
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.meeting-synthesis .level-tab {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
    padding: var(--space-3) var(--space-5);
    font-size: var(--text-lg);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.meeting-synthesis .level-tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
}

.meeting-synthesis .level-tab.active {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
}

/* Themes Section - Projector readable (MEET-06) */
.meeting-themes h2,
.meeting-gap h2 {
    font-size: clamp(1.5rem, 2.5vw, 2rem);
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: var(--space-4);
}

.meeting-themes p {
    font-size: clamp(1.5rem, 2.5vw, 2rem);
    line-height: 1.6;
    color: #eaeaea;
}

/* Gap Badge - Meeting size */
.meeting-gap {
    margin-top: var(--space-8);
}

.meeting-gap-badge {
    display: inline-block;
    font-size: clamp(1.5rem, 2.5vw, 2.5rem);
    font-weight: 700;
    padding: var(--space-3) var(--space-6);
    border-radius: 8px;
    margin-bottom: var(--space-3);
}

.meeting-gap-badge.gap-direction {
    background: #3B82F6;
    color: white;
}

.meeting-gap-badge.gap-alignment {
    background: #F59E0B;
    color: white;
}

.meeting-gap-badge.gap-commitment {
    background: #10B981;
    color: white;
}

.meeting-gap-reasoning {
    font-size: clamp(1.125rem, 1.5vw, 1.5rem);
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.6;
}

/* Insights List - Projector readable */
.meeting-insights {
    list-style: none;
    padding: 0;
    margin: 0;
}

.meeting-insights li {
    padding: var(--space-4) 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-size: clamp(1.25rem, 2vw, 1.75rem);
}

.meeting-insights li:last-child {
    border-bottom: none;
}

.meeting-insights .insight-statement {
    display: block;
    margin-bottom: var(--space-2);
    color: #eaeaea;
}

.meeting-insights .insight-names {
    font-size: clamp(1rem, 1.25vw, 1.25rem);
    color: rgba(255, 255, 255, 0.5);
}

/* Raw Responses - Meeting size */
.meeting-raw .raw-participant {
    margin-bottom: var(--space-6);
    padding: var(--space-4);
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
}

.meeting-raw .raw-participant-name {
    font-size: clamp(1.25rem, 2vw, 1.75rem);
    font-weight: 600;
    margin-bottom: var(--space-3);
    color: rgba(255, 255, 255, 0.9);
}

.meeting-raw .raw-bullets {
    list-style: disc;
    padding-left: var(--space-5);
}

.meeting-raw .raw-bullets li {
    margin-bottom: var(--space-2);
    color: rgba(255, 255, 255, 0.8);
    font-size: clamp(1.125rem, 1.5vw, 1.5rem);
}

/* Empty/Error states */
.meeting-empty {
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
    font-size: clamp(1.125rem, 1.5vw, 1.5rem);
}

.meeting-error {
    text-align: center;
    padding: var(--space-12);
}

.meeting-error h2 {
    color: #ef4444;
    font-size: clamp(2rem, 3vw, 2.5rem);
    margin-bottom: var(--space-4);
}

.meeting-error p {
    color: rgba(255, 255, 255, 0.7);
    font-size: clamp(1.125rem, 1.5vw, 1.5rem);
}

.meeting-error-hint {
    margin-top: var(--space-4);
    color: rgba(255, 255, 255, 0.5);
}

/* Footer */
.meeting-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) var(--space-6);
}

.meeting-footer .keyboard-hint {
    position: static;
    color: rgba(255, 255, 255, 0.3);
    font-size: var(--text-sm);
}

.exit-meeting {
    color: rgba(255, 255, 255, 0.4);
    font-size: var(--text-sm);
    text-decoration: none;
}

.exit-meeting:hover {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
}

/* Responsive: Stack on narrow screens */
@media (max-width: 900px) {
    .meeting-capture {
        grid-template-columns: 1fr;
        gap: var(--space-6);
    }

    .meeting-qr-code {
        width: 300px;
        height: 300px;
    }

    .meeting-footer {
        flex-direction: column;
        gap: var(--space-2);
        text-align: center;
    }
}
```

This provides:
- MEET-06: Projector-optimized typography using clamp() for responsive scaling
- Min 24px body text (1.5rem base), 48px+ headings (3rem+)
- Same dark theme as existing capture-mode
- Grid layout for capture section matching existing capture.html
- Level tabs for synthesis navigation
  </action>
  <verify>
grep -n "Meeting Mode" the55/app/static/css/main.css
grep -c ".meeting-" the55/app/static/css/main.css (should be 40+)
  </verify>
  <done>Meeting mode CSS provides projector-readable typography and state-driven layout</done>
</task>

</tasks>

<verification>
1. Navigate to /admin/sessions/{id}/meeting for a session in CAPTURING state - should show QR + status
2. Navigate to /admin/sessions/{id}/meeting for a session in REVEALED state - should show synthesis
3. Check font sizes are readable from across the room (24px+ body, 48px+ headings)
4. Verify dark theme matches existing capture.html (#1a1a2e background)
</verification>

<success_criteria>
- MEET-01: Single /meeting URL serves both capture and presentation modes
- MEET-02: Capture mode shows QR code and participant status
- MEET-06: Typography is projector-optimized (readable from back of room)
- No admin controls visible on projected screen (MS-3 pitfall avoided)
</success_criteria>

<output>
After completion, create `.planning/phases/27-unified-meeting-screen/27-01-SUMMARY.md`
</output>
