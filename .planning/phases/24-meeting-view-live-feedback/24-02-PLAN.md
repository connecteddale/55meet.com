---
phase: 37-meeting-view-live-feedback
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - sites/55meet.com/templates/admin/sessions/meeting.html
  - sites/55meet.com/static/js/meeting.js
  - sites/55meet.com/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "Meeting view has a fixed bottom control strip with Close Capture button and contextual state hints"
    - "Control strip buttons are context-aware (show/hide based on current session state)"
    - "Meeting view auto-transitions between states using View Transitions API (wrap reloads in startViewTransition)"
    - "Transitions are smooth fade animations between capture/analyzing/synthesis states"
  artifacts:
    - path: "sites/55meet.com/templates/admin/sessions/meeting.html"
      provides: "Bottom control strip with state-aware action buttons"
      contains: "control-strip"
    - path: "sites/55meet.com/static/js/meeting.js"
      provides: "View Transition wrappers for state changes"
      contains: "startViewTransition"
    - path: "sites/55meet.com/static/css/main.css"
      provides: "Control strip styles and analyzing animation"
      contains: "control-strip"
  key_links:
    - from: "static/js/meeting.js"
      to: "window.location.reload"
      via: "startViewTransition wrapper"
      pattern: "startViewTransition.*reload"
    - from: "templates/admin/sessions/meeting.html"
      to: "/admin/sessions/{id}/close"
      via: "Close Capture button fetch POST"
      pattern: "control-strip.*close"
    - from: "templates/admin/sessions/meeting.html"
      to: "session.state.value"
      via: "Jinja2 conditional rendering"
      pattern: "control-strip.*state"
---

<objective>
Add a bottom control strip to the meeting projector view and wrap all state transitions in View Transitions API for smooth animations.

Purpose: Facilitator can control session flow directly from the projected view (no switching to admin panel), and state changes feel polished with animated transitions.
Output: Control strip in meeting.html, View Transition wrappers in meeting.js, control strip CSS styles.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@sites/55meet.com/templates/admin/sessions/meeting.html
@sites/55meet.com/static/js/meeting.js
@sites/55meet.com/static/css/main.css (lines 3106-3476 — meeting styles)
@sites/55meet.com/static/css/transitions.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bottom control strip to meeting template</name>
  <files>sites/55meet.com/templates/admin/sessions/meeting.html</files>
  <action>
Replace the existing `<footer class="meeting-footer">` section with a new control strip. The control strip is a fixed bottom bar that shows contextual action buttons based on session state.

Replace the footer with:
```html
{# Control Strip - Fixed bottom bar with contextual actions #}
<div class="meeting-control-strip" id="control-strip" data-session-id="{{ session.id }}">
    <div class="control-strip-left">
        <a href="/admin/sessions/{{ session.id }}" class="control-link">Exit Meeting</a>
    </div>
    <div class="control-strip-center">
        <span class="control-state-label" id="state-label">{{ session.state.value | title }}</span>
    </div>
    <div class="control-strip-right">
        {% if session.state.value == 'capturing' %}
        <button class="control-btn control-btn-close" id="btn-close-capture" onclick="closeCaptureFromStrip()">
            Close Capture
        </button>
        {% elif session.state.value == 'closed' %}
        <span class="control-hint">Auto-revealing when ready...</span>
        {% elif session.state.value == 'revealed' %}
        <span class="keyboard-hint">Keys 1, 2, 3 for detail levels</span>
        {% endif %}
    </div>
</div>
```

Note: We do NOT add a manual "Reveal Results" button because Phase 34 implemented auto-reveal (synthesis auto-sets state to REVEALED when complete). The control strip shows "Auto-revealing when ready..." in the closed state. If the facilitator needs manual reveal (failure case), they can exit to the session admin page.

The `closeCaptureFromStrip()` function will be added in meeting.js (Task 2).
  </action>
  <verify>Load the meeting page at `/admin/sessions/{id}/meeting` — control strip should be visible as a fixed bar at the bottom with contextual content based on session state.</verify>
  <done>Meeting template has a bottom control strip with Exit link, state label, and contextual action button (Close Capture during capturing state)</done>
</task>

<task type="auto">
  <name>Task 2: Add View Transitions and control strip actions to meeting.js</name>
  <files>sites/55meet.com/static/js/meeting.js</files>
  <action>
Two additions to meeting.js:

**1. Wrap all state transition reloads in View Transitions API:**

Replace the `handleStateTransition` function:
```javascript
function handleStateTransition(fromState, toState, data) {
    console.log(`Meeting state transition: ${fromState} -> ${toState}`);
    stopPolling();

    if (toState === 'revealed') {
        triggerCeremonyReveal();
    } else {
        // Wrap reload in View Transition for smooth fade
        transitionReload();
    }
}
```

Add a new `transitionReload()` helper:
```javascript
function transitionReload() {
    if (document.startViewTransition) {
        document.startViewTransition(() => {
            window.location.reload();
        });
    } else {
        window.location.reload();
    }
}
```

Also update `triggerCeremonyReveal()` to use View Transitions:
```javascript
function triggerCeremonyReveal() {
    document.body.classList.add('meeting-transitioning');

    const captureSection = document.getElementById('capture-section');
    if (captureSection) {
        captureSection.classList.add('collapsing');
    }

    setTimeout(() => {
        if (document.startViewTransition) {
            document.startViewTransition(() => {
                window.location.reload();
            });
        } else {
            window.location.reload();
        }
    }, 800);
}
```

**2. Add `closeCaptureFromStrip()` function (outside the IIFE, as a global):**

After the closing `})();` of the main IIFE, add:
```javascript
/**
 * Close capture from the meeting control strip (LIVE-04)
 */
async function closeCaptureFromStrip() {
    const btn = document.getElementById('btn-close-capture');
    if (!btn) return;

    btn.disabled = true;
    btn.textContent = 'Closing...';

    const strip = document.getElementById('control-strip');
    const sessionId = strip ? strip.dataset.sessionId : null;
    if (!sessionId) return;

    try {
        const response = await fetch(`/admin/sessions/${sessionId}/close`, {
            method: 'POST',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' }
        });

        if (response.ok) {
            // State change will be detected by next poll, triggering transition reload
            // But update label immediately for responsiveness
            const label = document.getElementById('state-label');
            if (label) label.textContent = 'Closed';
            btn.textContent = 'Closed';
        } else {
            btn.disabled = false;
            btn.textContent = 'Close Capture';
            console.error('Close capture failed:', response.status);
        }
    } catch (err) {
        btn.disabled = false;
        btn.textContent = 'Close Capture';
        console.error('Close capture error:', err);
    }
}
```

**3. Update state label on poll (inside updateCaptureUI or after state check):**

In the `pollStatus` function, after the state transition check, update the state label:
```javascript
// Update state label in control strip
const stateLabel = document.getElementById('state-label');
if (stateLabel) stateLabel.textContent = data.state.charAt(0).toUpperCase() + data.state.slice(1);
```
  </action>
  <verify>
1. Meeting page in capturing state: click "Close Capture" button, confirm it POSTs to close endpoint and button shows "Closing..."
2. When state changes (capturing -> closed -> revealed), confirm page transitions smoothly (fade animation, not hard reload flash)
3. In browsers without View Transitions API, confirm normal reload still works
  </verify>
  <done>Meeting.js wraps all state-change reloads in startViewTransition for smooth fades, and closeCaptureFromStrip() allows facilitator to close capture from the projected view</done>
</task>

<task type="auto">
  <name>Task 3: Add control strip CSS styles</name>
  <files>sites/55meet.com/static/css/main.css</files>
  <action>
After the existing meeting footer styles (around line 3460, after `.exit-meeting:hover`), replace the responsive section comment with the control strip styles THEN the responsive section:

Add these styles before the `@media (max-width: 900px)` block:

```css
/* Control Strip - Fixed bottom bar (LIVE-04) */
.meeting-control-strip {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-6);
    background: rgba(10, 10, 20, 0.95);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(8px);
    z-index: 100;
}

.control-strip-left,
.control-strip-right {
    flex: 1;
}

.control-strip-right {
    text-align: right;
}

.control-strip-center {
    text-align: center;
}

.control-link {
    color: rgba(255, 255, 255, 0.4);
    font-size: var(--text-sm);
    text-decoration: none;
    transition: color 0.2s;
}

.control-link:hover {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
}

.control-state-label {
    color: rgba(255, 255, 255, 0.5);
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.control-btn {
    padding: var(--space-2) var(--space-5);
    border-radius: 6px;
    font-size: var(--text-sm);
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
}

.control-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.control-btn-close {
    background: #dc2626;
    color: white;
}

.control-btn-close:hover:not(:disabled) {
    background: #b91c1c;
}

.control-hint {
    color: rgba(255, 255, 255, 0.4);
    font-size: var(--text-sm);
    font-style: italic;
}
```

Also add padding-bottom to `.meeting-screen` so content is not obscured by the fixed strip:
Find `.meeting-screen` (around line 3116) and add `padding-bottom: 60px;` to it.

Remove the old `.meeting-footer`, `.meeting-footer .keyboard-hint`, `.exit-meeting`, and `.exit-meeting:hover` styles (lines ~3437-3460) since the control strip replaces them.
  </action>
  <verify>
1. Load meeting page — control strip visible as frosted-glass bar at bottom
2. Content not hidden behind strip (padding-bottom on meeting-screen)
3. Close Capture button is red, shows hover state
4. On mobile (< 900px), strip should still be usable
  </verify>
  <done>Control strip is styled as a fixed frosted-glass bottom bar with proper spacing, button styles, and the meeting screen has bottom padding to avoid content overlap</done>
</task>

</tasks>

<verification>
1. Meeting page shows fixed bottom control strip in all states
2. Capturing state: "Close Capture" button visible and functional
3. Closed state: "Auto-revealing when ready..." hint shown
4. Revealed state: keyboard shortcuts hint shown
5. All state transitions use View Transitions API (smooth fade)
6. Fallback to hard reload in browsers without View Transitions API
7. Close Capture button POSTs to correct endpoint and updates UI
</verification>

<success_criteria>
- LIVE-03 satisfied: meeting view auto-transitions with smooth View Transition animations
- LIVE-04 satisfied: bottom control strip with Close Capture button
- Control strip is contextual (different content per state)
- No content hidden behind fixed strip
- Graceful degradation without View Transitions API
</success_criteria>

<output>
After completion, create `.planning/phases/37-meeting-view-live-feedback/37-02-SUMMARY.md`
</output>
