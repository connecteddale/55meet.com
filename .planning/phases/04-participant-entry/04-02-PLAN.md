---
phase: 13-participant-entry
plan: 02
type: execute
wave: 1
depends_on: [13-01]
files_modified:
  - the55/app/templates/participant/join.html
  - the55/app/templates/participant/select_session.html
  - the55/app/templates/participant/select_name.html
  - the55/app/templates/participant/strategy.html
  - the55/app/templates/participant/waiting.html
  - the55/app/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "Join page has prominent team code input"
    - "Session selection shows month stepper (← Month Year →)"
    - "Name selection shows team members with responded status"
    - "Strategy page displays team's strategy statement prominently"
    - "Waiting page shows clear feedback with session status"
    - "All pages are mobile-first (375px+)"
  artifacts:
    - path: "the55/app/templates/participant/join.html"
      provides: "Team code entry UI"
      contains: "team code"
    - path: "the55/app/templates/participant/select_session.html"
      provides: "Month stepper UI"
      contains: "session-stepper"
    - path: "the55/app/templates/participant/waiting.html"
      provides: "Waiting state UI"
      contains: "waiting"
  key_links:
    - from: "templates"
      to: "base.html"
      via: "extends"
      pattern: "extends.*base.html"
    - from: "waiting.html"
      to: "polling endpoint"
      via: "JavaScript fetch"
      pattern: "fetch"
---

<objective>
Create participant entry UI templates with mobile-first design.

Purpose: Provide clear, simple UI for participants to join sessions on mobile devices.
Output: Templates for join, session selection, name selection, strategy view, and waiting state.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@the55/app/routers/participant.py
@the55/app/templates/base.html
@the55/app/static/css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create participant templates directory and join template</name>
  <files>the55/app/templates/participant/join.html</files>
  <action>
    Create templates/participant directory:
    ```bash
    mkdir -p /var/www/the55/app/templates/participant
    ```

    Create join.html - prominent team code entry:
    ```html
    {% extends "base.html" %}

    {% block title %}Join Session - The 55{% endblock %}

    {% block header %}
    <header class="participant-header">
        <div class="container">
            <h1>The 55</h1>
        </div>
    </header>
    {% endblock %}

    {% block content %}
    <div class="join-page">
        <div class="join-card">
            <h2>Join Your Session</h2>
            <p class="join-subtitle">Enter your team code to get started</p>

            {% if error %}
            <div class="error-message">{{ error }}</div>
            {% endif %}

            <form method="post" action="/join" class="join-form">
                <div class="form-group">
                    <label for="code" class="visually-hidden">Team Code</label>
                    <input
                        type="text"
                        id="code"
                        name="code"
                        placeholder="TEAM CODE"
                        required
                        autocomplete="off"
                        autocapitalize="characters"
                        class="code-input"
                        maxlength="20"
                    >
                </div>
                <button type="submit" class="btn btn-primary btn-large btn-block">
                    Join
                </button>
            </form>

            <p class="join-hint">
                Ask your facilitator for the team code, or scan the QR code.
            </p>
        </div>
    </div>
    {% endblock %}
    ```
  </action>
  <verify>test -f /var/www/the55/app/templates/participant/join.html</verify>
  <done>Join template created with code input</done>
</task>

<task type="auto">
  <name>Task 2: Create session and name selection templates</name>
  <files>the55/app/templates/participant/select_session.html, the55/app/templates/participant/select_name.html</files>
  <action>
    Create select_session.html - month stepper:
    ```html
    {% extends "base.html" %}

    {% block title %}Select Month - The 55{% endblock %}

    {% block header %}
    <header class="participant-header">
        <div class="container">
            <h1>The 55</h1>
            <span class="team-badge">{{ team.team_name }}</span>
        </div>
    </header>
    {% endblock %}

    {% block content %}
    <div class="select-page">
        <div class="select-card">
            <h2>Select Month</h2>
            <p class="select-subtitle">Which session are you joining?</p>

            <form method="post" action="/join/{{ team.code }}/session" id="session-form">
                <input type="hidden" name="session_id" id="selected-session" value="{{ current_session.id }}">

                <div class="session-stepper">
                    <button type="button" class="stepper-btn stepper-prev" id="prev-btn">
                        <span class="stepper-arrow">&larr;</span>
                    </button>

                    <div class="stepper-display" id="month-display">
                        {{ current_session.month }}
                    </div>

                    <button type="button" class="stepper-btn stepper-next" id="next-btn">
                        <span class="stepper-arrow">&rarr;</span>
                    </button>
                </div>

                <button type="submit" class="btn btn-primary btn-large btn-block">
                    Continue
                </button>
            </form>
        </div>
    </div>
    {% endblock %}

    {% block scripts %}
    <script>
    (function() {
        const sessions = [
            {% for session in sessions %}
            { id: {{ session.id }}, month: "{{ session.month }}" }{% if not loop.last %},{% endif %}
            {% endfor %}
        ];

        let currentIndex = 0;
        const monthDisplay = document.getElementById('month-display');
        const hiddenInput = document.getElementById('selected-session');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        function formatMonth(monthStr) {
            const [year, month] = monthStr.split('-');
            const date = new Date(year, parseInt(month) - 1);
            return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        }

        function updateDisplay() {
            monthDisplay.textContent = formatMonth(sessions[currentIndex].month);
            hiddenInput.value = sessions[currentIndex].id;
            prevBtn.disabled = currentIndex === sessions.length - 1;
            nextBtn.disabled = currentIndex === 0;
        }

        prevBtn.addEventListener('click', function() {
            if (currentIndex < sessions.length - 1) {
                currentIndex++;
                updateDisplay();
            }
        });

        nextBtn.addEventListener('click', function() {
            if (currentIndex > 0) {
                currentIndex--;
                updateDisplay();
            }
        });

        updateDisplay();
    })();
    </script>
    {% endblock %}
    ```

    Create select_name.html - member list:
    ```html
    {% extends "base.html" %}

    {% block title %}Select Your Name - The 55{% endblock %}

    {% block header %}
    <header class="participant-header">
        <div class="container">
            <h1>The 55</h1>
            <span class="team-badge">{{ team.team_name }}</span>
        </div>
    </header>
    {% endblock %}

    {% block content %}
    <div class="select-page">
        <div class="select-card">
            <h2>Who Are You?</h2>
            <p class="select-subtitle">Select your name from the list</p>

            <form method="post" action="/join/{{ team.code }}/session/{{ session.id }}/name">
                <div class="name-list">
                    {% for member in members %}
                    <label class="name-option {% if member.id in responded_ids %}responded{% endif %}">
                        <input
                            type="radio"
                            name="member_id"
                            value="{{ member.id }}"
                            {% if member.id in responded_ids %}disabled{% endif %}
                            required
                        >
                        <span class="name-text">{{ member.name }}</span>
                        {% if member.id in responded_ids %}
                        <span class="responded-badge">Already responded</span>
                        {% endif %}
                    </label>
                    {% endfor %}
                </div>

                <button type="submit" class="btn btn-primary btn-large btn-block">
                    Continue
                </button>
            </form>
        </div>
    </div>
    {% endblock %}
    ```
  </action>
  <verify>test -f /var/www/the55/app/templates/participant/select_name.html</verify>
  <done>Session and name selection templates created</done>
</task>

<task type="auto">
  <name>Task 3: Create strategy and waiting templates</name>
  <files>the55/app/templates/participant/strategy.html, the55/app/templates/participant/waiting.html</files>
  <action>
    Create strategy.html - strategy statement display:
    ```html
    {% extends "base.html" %}

    {% block title %}Our Strategy - The 55{% endblock %}

    {% block header %}
    <header class="participant-header">
        <div class="container">
            <h1>The 55</h1>
            <span class="team-badge">{{ team.team_name }}</span>
        </div>
    </header>
    {% endblock %}

    {% block content %}
    <div class="strategy-page">
        <div class="strategy-card">
            <h2>Welcome, {{ member.name }}</h2>

            <div class="strategy-section">
                <h3>Our Strategy</h3>
                {% if team.strategy_statement %}
                <blockquote class="strategy-statement">
                    {{ team.strategy_statement }}
                </blockquote>
                {% else %}
                <p class="no-strategy">No strategy statement has been set for this team.</p>
                {% endif %}
            </div>

            <div class="strategy-instructions">
                <h3>What Happens Next</h3>
                <p>You'll be shown a collection of images. Select the one that best represents how you feel about where we are as a team in executing this strategy.</p>
                <p>Then, explain your choice in 1-5 bullet points.</p>
            </div>

            <a href="/join/{{ team.code }}/session/{{ session.id }}/member/{{ member.id }}/respond"
               class="btn btn-primary btn-large btn-block">
                I'm Ready
            </a>
        </div>
    </div>
    {% endblock %}
    ```

    Create waiting.html - waiting state with polling:
    ```html
    {% extends "base.html" %}

    {% block title %}Waiting - The 55{% endblock %}

    {% block header %}
    <header class="participant-header">
        <div class="container">
            <h1>The 55</h1>
            <span class="team-badge">{{ team.team_name }}</span>
        </div>
    </header>
    {% endblock %}

    {% block content %}
    <div class="waiting-page" data-session-id="{{ session.id }}" data-team-code="{{ team.code }}" data-member-id="{{ member.id }}">
        <div class="waiting-card">
            <div class="waiting-icon">
                <svg viewBox="0 0 24 24" width="64" height="64" class="spinner">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-dasharray="31.4 31.4" />
                </svg>
            </div>

            <h2>Thank You, {{ member.name }}</h2>

            <p class="waiting-message" id="waiting-message">
                {% if session.state.value == 'capturing' %}
                Your response has been submitted. Waiting for others to complete...
                {% elif session.state.value == 'closed' %}
                Capture is closed. Synthesis is being prepared...
                {% else %}
                Please wait while the facilitator reveals the results...
                {% endif %}
            </p>

            <div class="waiting-status">
                <span class="status-badge state-{{ session.state.value }}">
                    {{ session.state.value | title }}
                </span>
            </div>
        </div>
    </div>
    {% endblock %}

    {% block scripts %}
    <script>
    (function() {
        const POLL_INTERVAL = 3000;
        const container = document.querySelector('.waiting-page');
        const sessionId = container.dataset.sessionId;
        const teamCode = container.dataset.teamCode;
        const memberId = container.dataset.memberId;

        async function checkStatus() {
            try {
                const response = await fetch(`/join/${teamCode}/session/${sessionId}/status`);
                if (!response.ok) return;

                const data = await response.json();

                // Update message based on state
                const messageEl = document.getElementById('waiting-message');
                if (data.state === 'revealed') {
                    // Redirect to synthesis view
                    window.location.href = `/join/${teamCode}/session/${sessionId}/synthesis`;
                    return;
                } else if (data.state === 'closed') {
                    messageEl.textContent = 'Capture is closed. Synthesis is being prepared...';
                } else if (data.state === 'capturing') {
                    messageEl.textContent = `Your response has been submitted. Waiting for others (${data.submitted_count}/${data.total_members})...`;
                }
            } catch (err) {
                console.error('Status check failed:', err);
            }
        }

        // Poll every 3 seconds
        setInterval(checkStatus, POLL_INTERVAL);
    })();
    </script>
    {% endblock %}
    ```
  </action>
  <verify>test -f /var/www/the55/app/templates/participant/waiting.html</verify>
  <done>Strategy and waiting templates created</done>
</task>

<task type="auto">
  <name>Task 4: Add participant CSS styles</name>
  <files>the55/app/static/css/main.css</files>
  <action>
    Append participant styles to main.css:
    ```css
    /* Participant Flow */
    .participant-header {
        background: var(--color-primary);
        color: white;
        text-align: center;
    }

    .participant-header h1 {
        color: white;
    }

    .participant-header h1 a {
        color: white;
    }

    .team-badge {
        display: inline-block;
        background: rgba(255,255,255,0.2);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-size: 0.875rem;
        margin-left: var(--spacing-sm);
    }

    /* Join Page */
    .join-page {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 60vh;
    }

    .join-card {
        width: 100%;
        max-width: 400px;
        text-align: center;
        padding: var(--spacing-lg);
    }

    .join-subtitle {
        color: var(--color-text-secondary);
        margin-bottom: var(--spacing-lg);
    }

    .code-input {
        font-size: 1.5rem;
        text-align: center;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        padding: var(--spacing-md);
    }

    .code-input::placeholder {
        letter-spacing: 0.1em;
    }

    .join-hint {
        margin-top: var(--spacing-lg);
        color: var(--color-text-secondary);
        font-size: 0.875rem;
    }

    /* Error Message */
    .error-message {
        background: #fef2f2;
        color: #991b1b;
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        margin-bottom: var(--spacing-md);
    }

    /* Select Pages */
    .select-page {
        display: flex;
        justify-content: center;
        padding-top: var(--spacing-lg);
    }

    .select-card {
        width: 100%;
        max-width: 500px;
        text-align: center;
        padding: var(--spacing-lg);
    }

    .select-subtitle {
        color: var(--color-text-secondary);
        margin-bottom: var(--spacing-lg);
    }

    /* Session Stepper */
    .session-stepper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .stepper-btn {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid var(--color-border);
        background: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .stepper-btn:hover:not(:disabled) {
        border-color: var(--color-primary);
        color: var(--color-primary);
    }

    .stepper-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .stepper-arrow {
        font-size: 1.25rem;
    }

    .stepper-display {
        font-size: 1.25rem;
        font-weight: 600;
        min-width: 150px;
    }

    /* Name List */
    .name-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-lg);
        text-align: left;
    }

    .name-option {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-md);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.2s;
    }

    .name-option:hover:not(.responded) {
        border-color: var(--color-primary);
    }

    .name-option input[type="radio"] {
        width: 20px;
        height: 20px;
        accent-color: var(--color-primary);
    }

    .name-option.responded {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .name-text {
        flex: 1;
    }

    .responded-badge {
        font-size: 0.75rem;
        color: var(--color-text-secondary);
        background: var(--color-surface);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
    }

    /* Strategy Page */
    .strategy-page {
        display: flex;
        justify-content: center;
        padding-top: var(--spacing-lg);
    }

    .strategy-card {
        width: 100%;
        max-width: 600px;
        padding: var(--spacing-lg);
    }

    .strategy-section {
        margin: var(--spacing-lg) 0;
    }

    .strategy-statement {
        font-size: 1.25rem;
        font-style: italic;
        padding: var(--spacing-lg);
        background: var(--color-surface);
        border-left: 4px solid var(--color-primary);
        margin: var(--spacing-md) 0;
    }

    .no-strategy {
        color: var(--color-text-secondary);
        font-style: italic;
    }

    .strategy-instructions {
        background: #f0f9ff;
        padding: var(--spacing-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--spacing-lg);
    }

    .strategy-instructions h3 {
        margin-bottom: var(--spacing-sm);
    }

    .strategy-instructions p {
        margin-bottom: var(--spacing-sm);
    }

    .strategy-instructions p:last-child {
        margin-bottom: 0;
    }

    /* Waiting Page */
    .waiting-page {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 60vh;
    }

    .waiting-card {
        text-align: center;
        padding: var(--spacing-xl);
    }

    .waiting-icon {
        margin-bottom: var(--spacing-lg);
        color: var(--color-primary);
    }

    .spinner {
        animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .waiting-message {
        color: var(--color-text-secondary);
        margin-bottom: var(--spacing-lg);
        max-width: 300px;
        margin-left: auto;
        margin-right: auto;
    }

    .waiting-status {
        margin-top: var(--spacing-md);
    }

    /* Utility: Block button */
    .btn-block {
        display: block;
        width: 100%;
    }

    /* Visually hidden (for accessibility) */
    .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
    ```
  </action>
  <verify>grep "join-page" /var/www/the55/app/static/css/main.css</verify>
  <done>Participant CSS styles added</done>
</task>

<task type="auto">
  <name>Task 5: Add participant status polling endpoint</name>
  <files>the55/app/routers/participant.py</files>
  <action>
    Add status endpoint to participant.py for waiting page polling:
    ```python
    @router.get("/{code}/session/{session_id}/status")
    async def get_participant_status(
        code: str,
        session_id: int,
        db: Session = DbDep
    ):
        """Get session status for participant polling (JSON endpoint)."""
        from fastapi.responses import JSONResponse

        code = code.strip().upper()
        team = db.query(Team).filter(Team.code == code).first()
        if not team:
            raise HTTPException(status_code=404, detail="Team not found")

        session = db.query(SessionModel).filter(
            SessionModel.id == session_id,
            SessionModel.team_id == team.id
        ).first()

        if not session:
            raise HTTPException(status_code=404, detail="Session not found")

        # Get member counts
        members = db.query(Member).filter(Member.team_id == team.id).all()
        from app.db.models import Response
        responses = db.query(Response).filter(Response.session_id == session_id).all()

        return JSONResponse({
            "session_id": session_id,
            "state": session.state.value,
            "total_members": len(members),
            "submitted_count": len(responses)
        })
    ```
  </action>
  <verify>grep "get_participant_status" /var/www/the55/app/routers/participant.py</verify>
  <done>Participant status polling endpoint added</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 templates created in participant directory
- [ ] Join page has prominent code input with uppercase transform
- [ ] Session selection has month stepper with navigation
- [ ] Name selection shows members with responded status
- [ ] Strategy page displays strategy statement
- [ ] Waiting page polls for session state changes
- [ ] CSS styles support mobile-first design (375px+)
</verification>

<success_criteria>
- All tasks completed
- Templates render correctly
- Mobile-responsive at 375px
- Polling updates waiting page state
</success_criteria>

<output>
After completion, create `.planning/phases/13-participant-entry/13-02-SUMMARY.md`
</output>
