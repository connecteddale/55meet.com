---
phase: 25-interactive-demo
plan: 02
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - app/routers/demo.py
  - templates/demo/signal.html
  - static/js/demo-signal.js
autonomous: true

must_haves:
  truths:
    - "Visitor sees image browser matching real app experience"
    - "Visitor can select an image from 60-image subset"
    - "Visitor can enter 1-5 bullet points explaining their choice"
    - "Visitor response is saved to sessionStorage"
  artifacts:
    - path: "templates/demo/signal.html"
      provides: "Demo Signal Capture page"
      contains: "image-browser"
    - path: "static/js/demo-signal.js"
      provides: "Demo-specific image browser JS"
      contains: "sessionStorage"
  key_links:
    - from: "templates/demo/signal.html"
      to: "/api/images"
      via: "fetch in JS"
      pattern: "fetch.*api/images"
    - from: "static/js/demo-signal.js"
      to: "sessionStorage"
      via: "state persistence"
      pattern: "sessionStorage.setItem"
---

<objective>
Create the Signal Capture experience page where visitors browse images, select one, and enter bullet points - mirroring the real participant experience but storing state in sessionStorage instead of database.

Purpose: This is the core interactive element of the demo - visitors actually experience Signal Capture firsthand. Uses the same 60-image subset approach and image browser UI as the real app.

Output: Working /demo/signal page with image browser, selection, and bullet input
</objective>

<execution_context>
@/home/DrPloy/.claude/get-shit-done/workflows/execute-plan.md
@/home/DrPloy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/25-interactive-demo/25-RESEARCH.md
@.planning/phases/25-interactive-demo/25-01-SUMMARY.md

# Key patterns to adapt
@templates/participant/respond.html (image browser pattern - THIS IS THE REFERENCE)
@app/routers/images.py (image API pattern)
@static/js/progressive-inputs.js (bullet input reveal pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Signal Capture route to demo router</name>
  <files>
    app/routers/demo.py
  </files>
  <action>
Add to app/routers/demo.py:

1. Route GET /demo/signal -> demo_signal():
   - Get seed from query param (required for consistent image ordering)
   - If no seed, redirect to /demo (must start from beginning)
   - Get shuffled team using the seed
   - Return templates.TemplateResponse("demo/signal.html", {
       request,
       company: DEMO_COMPANY,
       team_members: team,
       seed,
       per_page: 20  # Same as real app
     })

Note: The demo does NOT write to database. Visitor response will be stored in sessionStorage by client-side JS, then read on the responses page.
  </action>
  <verify>
curl -s "http://localhost:8000/demo/signal?seed=12345" | grep -q "image-browser" && echo "Signal page loads" || echo "FAIL"
curl -s -o /dev/null -w "%{http_code}" "http://localhost:8000/demo/signal" | grep -q "30" && echo "Redirects without seed" || echo "FAIL: Should redirect"
  </verify>
  <done>
/demo/signal route exists, requires seed parameter, returns signal capture template
  </done>
</task>

<task type="auto">
  <name>Task 2: Create demo Signal Capture template and JS</name>
  <files>
    templates/demo/signal.html
    static/js/demo-signal.js
  </files>
  <action>
Create templates/demo/signal.html adapting from participant/respond.html:

1. Extends base.html, title "Signal Capture - Demo"

2. Header with "The 55" branding, "Demo" badge, company name badge

3. Strategy banner showing {{ company.strategy }}

4. Browser instruction section:
   - "Your Turn" heading
   - Instruction: "Select the image that best represents how this team is executing their strategy."
   - Page indicator and prev/next buttons (same pattern as respond.html)

5. Image grid container (loaded via JS from /api/images)

6. Bullet section (hidden until image selected):
   - Selected image preview
   - "Why did you choose this image?" prompt
   - 5 bullet inputs (first required, others progressive reveal)

7. Submit section:
   - "See Team Responses" button (disabled until valid)
   - Hint text showing current state

8. Key differences from respond.html:
   - NO form POST - uses JS navigation
   - Saves to sessionStorage instead of form submission
   - Links to /demo/responses?seed={{ seed }}

Create static/js/demo-signal.js:

1. Constants:
   - DEMO_STATE_KEY = 'the55-demo-response'
   - Get seed from data attribute or URL param
   - perPage = 20

2. State management functions:
   - saveDemoState(imageId, imageUrl, bullets): Save to sessionStorage
   - loadDemoState(): Read from sessionStorage, return null if not found or wrong seed
   - clearDemoState(): Remove from sessionStorage

3. Image loading (reuse pattern from respond.html):
   - loadPage(pageNum): Fetch from /api/images?page=X&per_page=20&seed=SEED
   - renderPage(images): Build image grid HTML
   - attachCardHandlers(): Click/keyboard handlers for selection
   - updatePagination(pageNum): Update prev/next/indicator

4. Image selection:
   - selectImage(imageId, imageUrl): Update visual state, show bullet section, save state
   - jumpToSelection(): Navigate to page with selected image

5. Bullet handling:
   - Progressive reveal (show next input when current has content)
   - Save state on every input change

6. Navigation:
   - On "See Team Responses" click:
     - Validate at least 1 bullet
     - Save final state to sessionStorage
     - Navigate to /demo/responses?seed=SEED (with View Transition if supported)

7. Initialization:
   - Load any saved state (restore selection/bullets if same seed)
   - Load first page of images

Include progressive-inputs.js for bullet reveal behavior.

Add View Transition names to main elements for smooth page transition.
  </action>
  <verify>
# Check template structure
curl -s "http://localhost:8000/demo/signal?seed=12345" | grep -q "image-grid-container" && echo "Grid container exists" || echo "FAIL"
curl -s "http://localhost:8000/demo/signal?seed=12345" | grep -q "bullet-section" && echo "Bullet section exists" || echo "FAIL"
curl -s "http://localhost:8000/demo/signal?seed=12345" | grep -q "demo-signal.js" && echo "JS included" || echo "FAIL"

# Check JS file exists
test -f /var/www/sites/55meet.com/static/js/demo-signal.js && echo "JS file exists" || echo "FAIL: JS file missing"
  </verify>
  <done>
/demo/signal shows image browser with 60-image subset (paginated), visitor can select image and enter bullets, state saved to sessionStorage, "See Team Responses" navigates to /demo/responses
  </done>
</task>

</tasks>

<verification>
1. Navigate to /demo/signal?seed=12345 - shows image browser
2. Images load in paginated grid (20 per page)
3. Can navigate between pages with prev/next
4. Clicking image shows selection state and reveals bullet section
5. First bullet is required, others reveal progressively
6. "See Team Responses" button enables when image selected + 1 bullet entered
7. After clicking button, navigates to /demo/responses?seed=12345
8. sessionStorage contains demo response with imageId, imageUrl, bullets
9. Page refresh maintains selection state (same seed)
10. View Transitions work (if browser supports)
</verification>

<success_criteria>
- /demo/signal displays image browser with same UX as real app
- Visitor can browse, select, and explain image choice
- State persists in sessionStorage (survives refresh)
- Navigation to /demo/responses works
- Matches existing design system
</success_criteria>

<output>
After completion, create `.planning/phases/25-interactive-demo/25-02-SUMMARY.md`
</output>
