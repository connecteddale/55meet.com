---
phase: 25-interactive-demo
plan: 03
type: execute
wave: 3
depends_on: ["25-02"]
files_modified:
  - app/routers/demo.py
  - templates/demo/responses.html
autonomous: true

must_haves:
  truths:
    - "Visitor's response appears alongside 4 pre-baked team responses"
    - "Each pre-baked response shows Alignment gap indicators"
    - "All 5 responses display with image, name/role, and bullets"
  artifacts:
    - path: "app/routers/demo.py"
      provides: "Pre-baked team responses data"
      contains: "DEMO_RESPONSES"
    - path: "templates/demo/responses.html"
      provides: "Team responses display"
      contains: "response-card"
  key_links:
    - from: "templates/demo/responses.html"
      to: "sessionStorage"
      via: "JS reads visitor response"
      pattern: "sessionStorage.getItem"
---

<objective>
Create the team responses page showing the visitor's response alongside 4 pre-baked team responses, each with images and bullet points that collectively reveal an Alignment gap.

Purpose: This is the "aha moment" - the visitor sees their response next to the fictional team's responses and notices the pattern of disconnection that signals an Alignment gap.

Output: Working /demo/responses page showing all 5 responses in a consistent format
</objective>

<execution_context>
@/home/DrPloy/.claude/get-shit-done/workflows/execute-plan.md
@/home/DrPloy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/25-interactive-demo/25-RESEARCH.md
@.planning/phases/25-interactive-demo/25-01-SUMMARY.md
@.planning/phases/25-interactive-demo/25-02-SUMMARY.md

# Reference patterns
@templates/admin/sessions/view.html (response display pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pre-baked team responses and responses route</name>
  <files>
    app/routers/demo.py
  </files>
  <action>
Add to app/routers/demo.py:

1. Pre-baked team responses constant DEMO_RESPONSES - list of 4 dicts, each with:
   - role: matches DEMO_TEAM roles (CTO, CFO, VP Sales, COO)
   - image_filename: actual image filename from the library (pick 4 that exist)
   - bullets: list with 1-2 bullets showing Alignment gap signals

   Example content (adjust based on actual library images):
   ```python
   DEMO_RESPONSES = [
       {
           "role": "CTO",
           "image_filename": "tangled-threads.jpg",  # Or actual filename
           "bullets": [
               "We're building features but product and sales aren't synced on what clients actually need first"
           ]
       },
       {
           "role": "CFO",
           "image_filename": "relay-race.jpg",
           "bullets": [
               "Projects start strong but stall at the handoff between dev and client success"
           ]
       },
       {
           "role": "VP Sales",
           "image_filename": "bridge-gap.jpg",
           "bullets": [
               "I'm selling capabilities we don't have yet while engineering builds things nobody asked for"
           ]
       },
       {
           "role": "COO",
           "image_filename": "puzzle-scattered.jpg",
           "bullets": [
               "Everyone's working hard but the pieces aren't connecting"
           ]
       }
   ]
   ```

2. Helper function get_response_image_url(filename: str) -> str:
   - Return URL path like "/static/images/library/reducedlive/{filename}"
   - Or use demo-specific images if added: "/static/images/demo/{filename}"

3. Route GET /demo/responses -> demo_responses():
   - Get seed from query param (required)
   - If no seed, redirect to /demo
   - Get shuffled team
   - Build team_responses list by combining team names with DEMO_RESPONSES:
     - For each team member, find matching response by role
     - Add name and first_name from shuffled team
     - Add image_url via helper function
   - Return templates.TemplateResponse("demo/responses.html", {
       request,
       company: DEMO_COMPANY,
       team_responses: team_responses,  # 4 pre-baked
       seed
     })

Note: Visitor response comes from sessionStorage (client-side), not passed from server.
  </action>
  <verify>
curl -s "http://localhost:8000/demo/responses?seed=12345" | grep -q "response" && echo "Responses page loads" || echo "FAIL"
python -c "from app.routers.demo import DEMO_RESPONSES; print(f'{len(DEMO_RESPONSES)} team responses defined')"
  </verify>
  <done>
DEMO_RESPONSES constant has 4 pre-baked responses with alignment gap indicators, /demo/responses route serves responses page with team data
  </done>
</task>

<task type="auto">
  <name>Task 2: Create team responses template</name>
  <files>
    templates/demo/responses.html
  </files>
  <action>
Create templates/demo/responses.html:

1. Extends base.html, title "Team Responses - Demo"

2. Header with branding and company badge

3. Page intro section:
   - Heading: "Team Responses"
   - Subtext: "Here's what the {{ company.name }} leadership team shared."

4. Responses grid (CSS grid, responsive):
   - 1 column on mobile, 2-3 columns on tablet/desktop
   - Each response is a .response-card

5. Visitor response card (populated by JS from sessionStorage):
   - ID: visitor-response-card
   - Initially shows placeholder: "Your Response" with loading indicator
   - JS will populate: image, "You" as name, bullets

6. Team response cards (server-rendered, loop through team_responses):
   - Image thumbnail ({{ response.image_url }})
   - Name and role: "{{ response.name }}" / "{{ response.role }}"
   - Bullets list

7. Response card structure (shared between visitor and team):
   ```html
   <div class="response-card">
     <div class="response-image">
       <img src="..." alt="Selected image">
     </div>
     <div class="response-content">
       <h4 class="response-name">Name</h4>
       <span class="response-role">Role</span>
       <ul class="response-bullets">
         <li>Bullet point</li>
       </ul>
     </div>
   </div>
   ```

8. Pattern observation prompt (after responses):
   - "Notice any patterns?"
   - Brief text: "Each person is working hard, but are they pulling in the same direction?"

9. CTA to synthesis:
   - "See What We Found" button
   - Links to /demo/synthesis?seed={{ seed }}

10. Inline JS to populate visitor response:
    ```javascript
    (function() {
      const DEMO_STATE_KEY = 'the55-demo-response';
      const visitorCard = document.getElementById('visitor-response-card');

      function loadVisitorResponse() {
        try {
          const saved = sessionStorage.getItem(DEMO_STATE_KEY);
          if (!saved) {
            // No response - redirect back
            window.location.href = '/demo';
            return;
          }
          const data = JSON.parse(saved);
          // Populate visitor card
          visitorCard.querySelector('.response-image img').src = data.imageUrl;
          visitorCard.querySelector('.response-name').textContent = 'You';
          visitorCard.querySelector('.response-role').textContent = 'Demo Participant';

          const bulletsList = visitorCard.querySelector('.response-bullets');
          bulletsList.innerHTML = data.bullets.map(b => `<li>${escapeHtml(b)}</li>`).join('');

          visitorCard.classList.add('loaded');
        } catch (e) {
          console.error('Failed to load visitor response:', e);
          window.location.href = '/demo';
        }
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      loadVisitorResponse();
    })();
    ```

11. CSS for response cards (inline or style block):
    - .response-card: border, padding, background
    - .response-image img: aspect-ratio, object-fit cover
    - .response-grid: CSS grid with auto-fit columns
    - #visitor-response-card: slightly different border/highlight to distinguish

12. View Transition names on main elements
  </action>
  <verify>
curl -s "http://localhost:8000/demo/responses?seed=12345" | grep -q "visitor-response-card" && echo "Visitor card present" || echo "FAIL"
curl -s "http://localhost:8000/demo/responses?seed=12345" | grep -q "response-card" && echo "Response cards present" || echo "FAIL"
curl -s "http://localhost:8000/demo/responses?seed=12345" | grep -q "/demo/synthesis" && echo "Synthesis link present" || echo "FAIL"
  </verify>
  <done>
/demo/responses displays visitor response (from sessionStorage) alongside 4 pre-baked team responses, all showing images and bullets, with CTA to synthesis page
  </done>
</task>

</tasks>

<verification>
1. Complete Signal Capture first (select image, enter bullets)
2. Navigate to /demo/responses?seed=12345
3. See visitor's response card with their image and bullets
4. See 4 team response cards with names matching intro page
5. Each team response shows image and alignment-gap-indicating bullets
6. "See What We Found" button links to /demo/synthesis
7. If no visitor response in sessionStorage, redirects to /demo
8. Layout is responsive (stacks on mobile)
9. View Transitions work between pages
</verification>

<success_criteria>
- Visitor response loads from sessionStorage and displays
- 4 pre-baked team responses display with correct images and bullets
- Team member names match those shown on intro page (same seed)
- All responses suggest coordination/handoff problems (Alignment gap)
- CTA navigates to synthesis page
</success_criteria>

<output>
After completion, create `.planning/phases/25-interactive-demo/25-03-SUMMARY.md`
</output>
