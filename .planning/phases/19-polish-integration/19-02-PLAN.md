---
phase: 28-polish-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - the55/app/templates/errors/404.html
  - the55/app/templates/errors/500.html
  - the55/app/main.py
  - the55/app/static/css/main.css
autonomous: true

must_haves:
  truths:
    - "404 errors show a friendly page instead of JSON/technical error"
    - "500 errors show a friendly page with recovery options"
    - "Error pages have consistent styling with rest of application"
  artifacts:
    - path: "the55/app/templates/errors/404.html"
      provides: "Friendly 404 error page"
      min_lines: 15
    - path: "the55/app/templates/errors/500.html"
      provides: "Friendly 500 error page"
      min_lines: 15
    - path: "the55/app/main.py"
      provides: "Custom exception handlers"
      contains: "exception_handler"
  key_links:
    - from: "the55/app/main.py"
      to: "the55/app/templates/errors/404.html"
      via: "exception handler"
      pattern: "@app.exception_handler"
---

<objective>
Add graceful error handling with custom error pages.

Purpose: Prevent technical error messages from appearing on projection screens or confusing participants. Provide clear recovery paths for all error states.

Output: Custom 404 and 500 error templates with exception handlers in main.py.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-polish-integration/28-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Error Page Templates</name>
  <files>the55/app/templates/errors/404.html, the55/app/templates/errors/500.html</files>
  <action>
  1. Create the errors directory: `mkdir -p the55/app/templates/errors`

  2. Create 404.html:
  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Page Not Found - The 55</title>
      <link rel="stylesheet" href="/static/css/main.css">
  </head>
  <body>
      <main id="main-content">
          <div class="container">
              <div class="error-page">
                  <h1>Page Not Found</h1>
                  <p class="text-secondary">The page you're looking for doesn't exist or may have been moved.</p>
                  <div class="error-actions">
                      <a href="/" class="btn btn-primary">Go to Homepage</a>
                      <a href="/admin" class="btn btn-secondary">Facilitator Dashboard</a>
                  </div>
              </div>
          </div>
      </main>
  </body>
  </html>
  ```

  3. Create 500.html:
  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Something Went Wrong - The 55</title>
      <link rel="stylesheet" href="/static/css/main.css">
  </head>
  <body>
      <main id="main-content">
          <div class="container">
              <div class="error-page">
                  <h1>Something Went Wrong</h1>
                  <p class="text-secondary">We encountered an unexpected error. Please try again.</p>
                  <div class="error-actions">
                      <a href="javascript:location.reload()" class="btn btn-primary">Try Again</a>
                      <a href="/" class="btn btn-secondary">Go to Homepage</a>
                  </div>
              </div>
          </div>
      </main>
  </body>
  </html>
  ```

  Note: These are standalone templates (not extending base.html) to ensure they render even if there are template errors.
  </action>
  <verify>
  - Files exist: ls the55/app/templates/errors/
  - Templates have proper HTML structure
  </verify>
  <done>Error templates created at the55/app/templates/errors/</done>
</task>

<task type="auto">
  <name>Task 2: Add Exception Handlers to main.py</name>
  <files>the55/app/main.py</files>
  <action>
  1. Read the current main.py to understand the structure

  2. Add imports at the top if not present:
     ```python
     from fastapi import Request
     from fastapi.responses import HTMLResponse
     from starlette.exceptions import HTTPException as StarletteHTTPException
     ```

  3. Add exception handlers after the app initialization (after `app = FastAPI(...)`):
     ```python
     @app.exception_handler(404)
     async def not_found_handler(request: Request, exc: StarletteHTTPException):
         """Custom 404 page for browser requests."""
         accept = request.headers.get("accept", "")
         if "text/html" in accept:
             return templates.TemplateResponse(
                 "errors/404.html",
                 {"request": request},
                 status_code=404
             )
         # Return JSON for API requests
         return JSONResponse(
             status_code=404,
             content={"detail": "Not found"}
         )

     @app.exception_handler(500)
     async def server_error_handler(request: Request, exc: Exception):
         """Custom 500 page for browser requests."""
         accept = request.headers.get("accept", "")
         if "text/html" in accept:
             return templates.TemplateResponse(
                 "errors/500.html",
                 {"request": request},
                 status_code=500
             )
         return JSONResponse(
             status_code=500,
             content={"detail": "Internal server error"}
         )
     ```

  4. Also add JSONResponse import if needed:
     ```python
     from fastapi.responses import HTMLResponse, JSONResponse
     ```

  Note: The handlers check Accept header to return HTML for browsers and JSON for API requests. This preserves API behavior while improving browser experience.
  </action>
  <verify>
  - Visit a non-existent page like /admin/nonexistent - should show friendly 404 page
  - API calls should still return JSON errors (test with curl)
  </verify>
  <done>Exception handlers return friendly HTML for browsers, JSON for API calls</done>
</task>

<task type="auto">
  <name>Task 3: Add Error Page CSS Styling</name>
  <files>the55/app/static/css/main.css</files>
  <action>
  Add error page styles to main.css:
  ```css
  /* Error Pages */
  .error-page {
      text-align: center;
      padding: var(--space-16) var(--space-4);
      max-width: 500px;
      margin: 0 auto;
  }

  .error-page h1 {
      font-size: var(--text-3xl);
      margin-bottom: var(--space-4);
  }

  .error-page p {
      margin-bottom: var(--space-8);
      max-width: none;
  }

  .error-actions {
      display: flex;
      gap: var(--space-4);
      justify-content: center;
      flex-wrap: wrap;
  }
  ```

  These styles create a centered, clean error page layout consistent with the premium design tokens.
  </action>
  <verify>
  - View 404 page - should be centered with proper spacing
  - Buttons should be styled correctly
  - Page should be responsive on mobile
  </verify>
  <done>Error pages have consistent premium styling</done>
</task>

</tasks>

<verification>
1. Visit /nonexistent-page - friendly 404 appears with navigation options
2. Error pages use design tokens and look premium
3. API endpoints still return JSON errors (curl -H "Accept: application/json" /api/nonexistent)
4. Error pages work standalone (no template inheritance errors)
</verification>

<success_criteria>
- 404 errors show friendly page with navigation
- 500 errors show friendly page with retry option
- Error pages styled consistently with application
- API requests still receive JSON responses
- Error pages work even if base template has issues
</success_criteria>

<output>
After completion, create `.planning/phases/28-polish-integration/28-02-SUMMARY.md`
</output>
